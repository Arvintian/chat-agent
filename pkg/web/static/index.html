<!DOCTYPE html>
<html>

<head>
    <title>Chat-Agent</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-highlight/lib/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-katex-extension@5.1.7/lib/index.umd.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="login-panel" id="login-panel">
        <h2 id="login-header">ü§ñ Chat-Agent</h2>
        <div class="login-controls">
            <select id="chat-select">
                <option value="">-- Select a chat --</option>
            </select>
            <button id="start-btn" onclick="startChat()">Start Chat</button>
        </div>
    </div>

    <div class="page-wrapper" id="chat-panel" style="display: none; flex-direction: column;">
        <div class="header">
            <div class="header-left">
                <button id="keep-btn" onclick="keepSession()" title="Execute Keep Hook">üíæ Keep</button>
                <span id="agent-header">ü§ñ Chat-Agent</span>
            </div>
            <div class="header-right">
                <button id="clear-btn" onclick="showClearModal()" title="Clear Conversation">üóëÔ∏è Clear</button>
            </div>
        </div>

        <!-- Clear Session Modal -->
        <div id="clear-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üóëÔ∏è Clear Conversation</h3>
                    <span class="modal-close" onclick="hideClearModal()">√ó</span>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to clear the conversation context for: <span id="clear-chat-name"
                            style="font-weight: bold; margin: 10px 0; color: #667eea;"></span></p>
                    <div class="clear-option">
                        <label for="clear-all-records">
                            <input type="checkbox" id="clear-all-records">
                            <span>Also delete all local storage records for this chat</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-cancel" onclick="hideClearModal()">Cancel</button>
                    <button class="btn-confirm" onclick="confirmClear(); return false;">Clear</button>
                </div>
            </div>
        </div>

        <!-- Image Preview Modal -->
        <div id="image-preview-modal" class="modal" style="display: none;" onclick="hideImagePreview()">
            <div class="image-preview-modal-content" onclick="event.stopPropagation();">
                <span class="image-preview-close" onclick="hideImagePreview()">&times;</span>
                <img id="image-preview-full" src="" alt="Preview" />
                <div class="image-preview-nav">
                    <button class="image-preview-nav-btn" onclick="navigatePreview(-1)">&#10094; Prev</button>
                    <span id="image-preview-counter"></span>
                    <button class="image-preview-nav-btn" onclick="navigatePreview(1)">Next &#10095;</button>
                </div>
            </div>
        </div>

        <!-- Approval Modal -->
        <div id="approval-modal" class="modal" style="display: none;" onclick="return false;">
            <div class="modal-content approval-modal-content" onclick="event.stopPropagation();">
                <div class="modal-header approval-modal-header">
                    <h3>‚ö†Ô∏è Tool Approval Required</h3>
                </div>
                <div class="modal-body approval-modal-body">
                    <p class="approval-description">The following tool(s) require your approval to execute:</p>
                    <p class="approval-count">Total: <span id="approval-count">0</span> tool(s)</p>
                    <div id="approval-targets" class="approval-targets-container">
                        <!-- Targets will be dynamically inserted here -->
                    </div>
                </div>
                <div class="modal-footer approval-modal-footer">
                    <div class="bulk-actions">
                        <button class="btn-approve-all" onclick="approveAllAndSubmit()">‚úÖ Approve All</button>
                        <button class="btn-deny-all" onclick="denyAllAndSubmit()">‚ùå Deny All</button>
                    </div>
                    <button class="btn-confirm" id="btn-submit-approval" onclick="submitApprovals()" disabled>Submit
                        Decision</button>
                </div>
            </div>
        </div>

        <div class="toast-container" id="toast-container">
        </div>
        <div id="messages">
        </div>
        <div id="input-area">
            <!-- Image preview container -->
            <div id="image-preview-container" class="image-preview-container" style="display: none;"></div>

            <div class="input-wrapper">
                <!-- Image upload button -->
                <button id="upload-btn" onclick="document.getElementById('file-input').click()" title="Upload file">
                    üìé
                </button>
                <input type="file" id="file-input"
                    accept="image/*,video/*,audio/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv"
                    multiple onchange="handleFiles(this.files)" style="display: none;" />

                <textarea id="message-input" placeholder="Type your message..."
                    onkeydown="handleKeyDown(event)"></textarea>
                <button id="send-btn" onclick="sendMessage()" title="Send message">‚û§</button>
            </div>
        </div>
    </div>

    <script src="image-compressor.js"></script>
    <script src="file-upload.js"></script>
    <script src="indexeddb.js"></script>
    <script src="scroll-handler.js"></script>
    <script src="input-history.js"></script>
    <script src="message-history.js"></script>
    <script src="image-preview.js"></script>
    <script src="app.js"></script>
</body>

</html>